# 启动页优化攻略

平时我们在开发App时，都会设置一个启动页SplashActivity。用于一些网络初始请求进行数据的预加载，然后通过intent传递到MainActivity。
 
优点：启动速度有所加快。

缺点：最终我们还是要进入主界面，进入主界面还需要负责view的绘制以及必须在ui线程执行的业务逻辑，这样仍然会拖慢我们的启动速度。

这时我们应该考虑，能否在启动页展示的同时，首页的view就能够被加载，首页的业务逻辑就能够被执行？

优化思路：
将SplashActivity改成SplashFragment,应用程序的入口仍然是MainActivity，将SplashFragment加入到MainActivity中。
当SplashFragment显示完毕后再将它移除掉，于此同时我们可以在SplahFragment显示的时候进行网络数据缓存，在窗口加载完成后，
我们再去加载主界面的布局。考虑到主界面的布局可能相对复杂，耽误view的解析时间，我们可以使用ViewStub进行懒加载。（
关于ViewStub我们可以理解为界面加载时无关的布局不进行绘制等有需要再绘制。详细的可以参考http://www.jianshu.com/p/5f64bacbd759 ViewStub用法详解）

这样的话一开始只需要加载SplashFragment所展示的布局就可以了。采用以上方式后，可以发现启动速度得到很大的改观。有兴趣可以下载demo研究

## 启动页优化的一些其他思路
 1. 避免启动页UI的过度绘制，减少UI重复绘制时间，打开设置中的GPU过度绘制开关，界面整体呈现浅色，
 特别复杂的界面，红色区域也不应该超过全屏幕的四分之一； 
 
 2. 主线程中的所有SharedPreference能否在非UI线程中进行，SharedPreferences的apply函数需要注意，
 因为Commit函数会阻塞IO，这个函数虽然执行很快，但是系统会有另外一个线程来负责写操作，当apply频率高的时候，
 该线程就会比较占用CPU资源。类似的还有统计埋点等，在主线程埋点但异步线程提交，频率高的情况也会出现这样的问题。 
 3. 对于首次启动的黑屏问题，对于“黑屏”是否可以设计一个.9图片替换掉，间接减少用户等待时间。 
 4. 对于网络错误界面，友好提示界面，使用ViewStub的方式，减少UI一次性绘制的压力。 
 5. Multidex的使用，也是拖慢启动速度的元凶，必须要做优化

